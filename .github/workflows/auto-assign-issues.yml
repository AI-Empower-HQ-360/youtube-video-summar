name: Auto Assign Issues

on:
  issues:
    types: [opened, labeled]

permissions:
  issues: write
  contents: read

jobs:
  auto-assign:
    runs-on: ubuntu-latest
    steps:
      - name: Auto assign to creator
        if: github.event.action == 'opened'
        uses: actions/github-script@60a0d83039c74a4aee543508d2ffcb1c3799cdea # v7.0.1
        with:
          script: |
            await github.rest.issues.addAssignees({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              assignees: [context.actor]
            });
            console.log(`Assigned issue #${context.issue.number} to ${context.actor}`);

      - name: Add to project
        uses: actions/github-script@60a0d83039c74a4aee543508d2ffcb1c3799cdea # v7.0.1
        with:
          github-token: ${{ secrets.PROJECT_TOKEN }}
          script: |
            const projectId = 'PVT_kwHODM-O-84BMQbT';
            const issueId = context.payload.issue.node_id;
            
            const mutation = `
              mutation {
                addProjectV2ItemById(input: {
                  projectId: "${projectId}"
                  contentId: "${issueId}"
                }) {
                  item {
                    id
                  }
                }
              }
            `;
            
            try {
              await github.graphql(mutation);
              console.log('Issue added to project');
            } catch (error) {
              console.log('Issue may already be in project');
            }
